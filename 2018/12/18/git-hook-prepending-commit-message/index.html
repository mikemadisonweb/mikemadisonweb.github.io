<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Prefix the commit message with the Jira ticket number using a git hook · todo(): redo · Mikhail Bakulin's blog</title><meta name="description" content="Set up git hook for prepending the commit message with the Atlassian Jira ticket number"><meta name="keywords"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon_tree.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://mikemadisonweb.github.io/atom.xml" title="todo(): redo · Mikhail Bakulin's blog"><!-- Global Site Tag (gtag.js) - Google Analytics--><script async src="https://www.googletagmanager.com/gtag/js?id=UA-106650807-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments)};
gtag('js', new Date());
gtag('config', 'UA-106650807-1');</script></head><body><div class="fixed-width"><header><a href="/" class="logo-link"><img src="/favicon_tree.png" alt="logo"><h1 class="logo-text"><span class="logo-slashes">// todo():</span><span>redo</span></h1></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/cv/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header></div><main class="container"><div class="post-img-container"><img src="https://mikemadisonweb.github.io/2018/12/18/git-hook-prepending-commit-message/featured-image.jpg" class="post-img"></div><div class="fixed-width"><div class="post"><article class="post-block"><h1 class="post-title"><span class="pre-title">//&nbsp;todo():&nbsp;</span>Prefix the commit message with the Jira ticket number using a git hook</h1><div class="post-tags"><a href="/tags/Git/" class="post-tag">Git</a><a href="/tags/Git-hook/" class="post-tag">Git hook</a><a href="/tags/Jira/" class="post-tag">Jira</a></div><div class="post-date">Dec 18, 2018</div><div class="post-content"><p>The goal is to provide a way to automate the process of specifying correct ticket numbers in commit messages in order for commits to be well distinguished and linked to the corresponding tickets in the issue tracker.<br><a id="more"></a><br>Usually, git hooks are stored in .git/hooks directory inside the project repository. These files should be named according to the name of the hook, should not have any extension and should be executable.</p>
<p>These requirements along with the list of available hooks are described in the <a href="https://git-scm.com/docs/githooks" target="_blank" rel="noopener">git documentation</a>. However it can be tedious to set up these hooks for each project, so you can specify a global directory for the hooks like this:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.hooksPath <span class="string">'~/.git-templates/hooks'</span></span><br></pre></td></tr></table></figure></p>
<p>The directory name can be different.</p>
<p>The appropriate hook type for modifying the commit message is prepare-commit-msg as it ensures that the commit message will be edited no matter whether it was passed to the -m console flag or typed inside the text editor.</p>
<p>So we need to create a file <code>~/.git-templates/hooks/prepare-commit-msg</code> with the following Bash script:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Include any branches for which you wish to disable this script</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$BRANCHES_TO_SKIP</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  BRANCHES_TO_SKIP=(master develop)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># Get the current branch name</span></span><br><span class="line">BRANCH_NAME=$(git symbolic-ref --short HEAD)</span><br><span class="line"><span class="comment"># Ticket name is retrieved as a string between the first slash and the second hyphen</span></span><br><span class="line">TICKET_NAME=$(<span class="built_in">echo</span> <span class="variable">$BRANCH_NAME</span> | sed -e <span class="string">'s/^[^\/]*\/\([^-]*-[^-]*\)-.*/\1/'</span>)</span><br><span class="line"></span><br><span class="line">BRANCH_EXCLUDED=$(<span class="built_in">printf</span> <span class="string">"%s\n"</span> <span class="string">"<span class="variable">$&#123;BRANCHES_TO_SKIP[@]&#125;</span>"</span> | grep -c <span class="string">"^<span class="variable">$BRANCH_NAME</span>$"</span>)</span><br><span class="line">ALREADY_IN_MSG=$(grep -c <span class="string">"<span class="variable">$TICKET_NAME</span>"</span> <span class="variable">$1</span>)</span><br><span class="line"><span class="comment"># If it isn't excluded or already in commit message, prepend the ticket name to the given message</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$BRANCH_NAME</span>"</span> ] &amp;&amp; ! [[ <span class="string">"<span class="variable">$BRANCH_EXCLUDED</span>"</span> -eq 1 ]] &amp;&amp; ! [[ <span class="string">"<span class="variable">$ALREADY_IN_MSG</span>"</span> -eq 1 ]]; <span class="keyword">then</span></span><br><span class="line">    sed -i.bak -e <span class="string">"1s/^/<span class="variable">$TICKET_NAME</span> /"</span> <span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<p>In this script, we assume that the ticket number is a project name separated with an auto-incremental number by a hyphen and it exists in the name of the branch. This assumption is valid most of the times as it is a usual naming convention for the Atlassian Stack(Jira, Bitbucket etc) </p>
<p>During the execution of the script the ticket number will be parsed from the name of the branch upon commit creation and added to the message. This script will be skipped for master and develop branches and it will check if the ticket number is already inside the message to restrict it to be added twice.</p>
<p>If in some case there is no need to use this hook it can be skipped on commit using –no-verify flag.</p>
</div><p class="ending"><i>That's all for today. Happy coding!</i></p></article></div></div></main><div class="fixed-width"><footer><div class="paginator"><a href="/2018/06/14/go-remote-debug/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'mikemadison';
var disqus_identifier = '2018/12/18/git-hook-prepending-commit-message/';
var disqus_title = 'Prefix the commit message with the Jira ticket number using a git hook';
var disqus_url = 'https://mikemadisonweb.github.io/2018/12/18/git-hook-prepending-commit-message/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//mikemadison.disqus.com/count.js" async></script><div class="copyright"><p><a href="/atom.xml"><img src="/images/rss_ico.png" class="rss-icon"><span> Feed |</span></a><a href="/sitemap.xml"><span> Sitemap |</span></a><span> © 2016 - 2020 <a href="https://mikemadisonweb.github.io">Mikhail Bakulin</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.</span></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>